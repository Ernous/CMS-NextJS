# CMS Блог

Современная CMS система для блогов на Next.js с поддержкой markdown, кастомных эмодзи, реакций и системы прав доступа.

## Возможности

- ✅ **Аутентификация и авторизация** - регистрация, вход, система ролей
- ✅ **Система прав доступа** - роли admin, moderator, author, user
- ✅ **Поддержка Markdown** - полная поддержка markdown с кастомными эмодзи
- ✅ **Кастомные эмодзи** - создание и управление пакетами эмодзи
- ✅ **Реакции на посты** - использование эмодзи как реакций
- ✅ **Медиа контент** - поддержка изображений и видео
- ✅ **Админ панель** - управление пользователями, постами, эмодзи
- ✅ **Современный UI** - красивый интерфейс на Tailwind CSS

## Технологии

- **Frontend**: Next.js 14, React, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **База данных**: MongoDB с Mongoose
- **Аутентификация**: JWT токены
- **Markdown**: react-markdown с remark-gfm
- **Иконки**: Lucide React

## Установка

1. **Клонируйте репозиторий**
```bash
git clone <repository-url>
cd cms-blog
```

2. **Установите зависимости**
```bash
npm install
```

3. **Настройте MongoDB**
- Установите MongoDB локально или используйте MongoDB Atlas
- Создайте базу данных `cms-blog`

4. **Настройте переменные окружения**
Скопируйте `.env.local.example` в `.env.local` и настройте:
```env
MONGODB_URI=mongodb://localhost:27017/cms-blog
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
NEXTAUTH_SECRET=your-nextauth-secret-key
NEXTAUTH_URL=http://localhost:3000
```

5. **Запустите проект**
```bash
npm run dev
```

Откройте [http://localhost:3000](http://localhost:3000) в браузере.

## Структура проекта

```
src/
├── app/                    # Next.js App Router
│   ├── api/               # API роуты
│   │   ├── auth/          # Аутентификация
│   │   ├── posts/         # Управление постами
│   │   ├── emojis/        # Управление эмодзи
│   │   └── emoji-packs/   # Управление пакетами эмодзи
│   ├── admin/             # Админ панель
│   ├── login/             # Страница входа
│   ├── register/          # Страница регистрации
│   └── posts/             # Страницы постов
├── components/            # React компоненты
├── contexts/              # React контексты
├── lib/                   # Утилиты и конфигурация
└── models/                # Mongoose модели
```

## Система ролей и прав

### Роли пользователей:
- **admin** - полный доступ ко всем функциям
- **moderator** - управление постами, модерация комментариев
- **author** - создание и редактирование постов
- **user** - просмотр постов, комментирование, реакции

### Права доступа:
- `create_post` - создание постов (только admin, moderator, author)
- `edit_post` - редактирование постов
- `delete_post` - удаление постов
- `publish_post` - публикация постов
- `manage_users` - управление пользователями
- `manage_emojis` - управление эмодзи
- `moderate_comments` - модерация комментариев
- `view_analytics` - просмотр аналитики
- `comment` - комментирование постов (только авторизованные пользователи)
- `react` - ставить реакции на посты (только авторизованные пользователи)

## Использование

### Создание первого админа

1. Зарегистрируйтесь как обычный пользователь
2. В MongoDB измените роль пользователя на "admin":
```javascript
db.users.updateOne(
  { email: "your-email@example.com" },
  { $set: { role: "admin" } }
)
```

### Создание постов

1. Войдите как пользователь с правами `create_post`
2. Нажмите "Новый пост" на главной странице
3. Заполните заголовок, содержание (поддерживается markdown)
4. Добавьте изображения, видео, теги
5. Опубликуйте пост

### Управление эмодзи

1. Войдите как админ
2. Перейдите в админ панель
3. Создайте пакет эмодзи
4. Добавьте эмодзи в пакет
5. Используйте `:shortcode:` в markdown для отображения эмодзи

### Комментирование постов

1. Войдите в систему
2. Откройте любой пост
3. Прокрутите вниз до раздела комментариев
4. Напишите комментарий и нажмите "Отправить"
5. Можете отвечать на другие комментарии

### Реакции на посты

1. Войдите в систему
2. Откройте любой пост
3. Нажмите на кнопку "+" рядом с реакциями
4. Выберите эмодзи для реакции
5. Нажмите на существующую реакцию для удаления

## API Endpoints

### Аутентификация
- `POST /api/auth/register` - регистрация
- `POST /api/auth/login` - вход

### Посты
- `GET /api/posts` - список постов
- `POST /api/posts` - создание поста
- `GET /api/posts/[slug]` - получение поста
- `PUT /api/posts/[slug]` - обновление поста
- `DELETE /api/posts/[slug]` - удаление поста

### Комментарии
- `GET /api/posts/[slug]/comments` - получение комментариев
- `POST /api/posts/[slug]/comments` - создание комментария
- `POST /api/comments/[id]/like` - лайк комментария

### Реакции
- `GET /api/posts/[slug]/reactions` - получение реакций
- `POST /api/posts/[slug]/reactions` - добавление реакции
- `DELETE /api/posts/[slug]/reactions` - удаление реакции

### Эмодзи
- `GET /api/emojis` - список эмодзи
- `POST /api/emojis` - создание эмодзи
- `GET /api/emoji-packs` - список пакетов
- `POST /api/emoji-packs` - создание пакета

## Разработка

### Добавление новых функций

1. Создайте модель в `src/models/`
2. Добавьте API роуты в `src/app/api/`
3. Создайте компоненты в `src/components/`
4. Добавьте страницы в `src/app/`

### Стилизация

Проект использует Tailwind CSS. Все стили находятся в компонентах.

### База данных

Используется MongoDB с Mongoose ODM. Схемы определены в `src/models/`.

## Лицензия

MIT License

## Поддержка

Если у вас есть вопросы или проблемы, создайте issue в репозитории.
